<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('partials/head') %>
    <link rel="stylesheet" href="/css/chatbots.css" />
    <link rel="stylesheet" href="/css/greetings.css" />
    <link rel="stylesheet" href="/css/chatui.css" />
  </head>

  <body>
    <div class="dashboard-container">
      <%- include('partials/sidebar') %>
      <main class="main-content">
        <%- include('partials/header') %>
        <div class="layout-container">
          <!-- AI Assistants Sidebar -->
          <div class="ai-sidebar">
            <div class="ai-sidebar-header">
              <h3 class="ai-sidebar-title">DKM ASSISTANTS</h3>
            </div>
          
            <div class="ai-teams-list">
              <% 
              // Group assistants by team
              const teams = {};
              assistants.forEach(assistant => {
                if (!teams[assistant.team]) {
                  teams[assistant.team] = [];
                }
                teams[assistant.team].push(assistant);
              });
              
              // Render each team and its assistants
              Object.keys(teams).forEach(function(team) { 
              %>
                <div class="ai-team-container">
                  <div class="ai-team-header" data-team="<%= team %>">
                    <div class="ai-team-icon">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 18l6-6-6-6"></path>
                      </svg>
                    </div>
                    <div class="ai-team-name"><%= team %></div>
                  </div>
                  
                  <div class="ai-team-assistants">
                    <% teams[team].forEach(function(assistant) { %>
                      <div 
                        class="ai-assistant-item <%= activeAssistant === assistant.name ? 'active' : '' %>"
                        data-assistant-id="<%= assistant.id %>"
                      >
                        <div class="ai-assistant-icon"><%- assistant.icon %></div>
                        <div class="ai-assistant-name"><%= assistant.name %></div>
                      </div>
                    <% }); %>
                  </div>
                </div>
              <% }); %>
            </div>
          </div>

          <!-- Main Content Area -->
          <div class="chat-main-content">
            <div class="chat-container">
              <!-- Chat Messages Area -->
              <div class="chat-messages" id="chatMessages">
                  <div class="greetings-message" id="emptyState">
                    <p class="text">
                      <span class="black">‚ü° </span>
                      <span class="orange" id="greeting-msg">Good afternoon</span><span class="black">, </span>
                      <span class="black"><%= user.username%></span>
                      <br>
                      <span class="gray">How can i help u today?</span>
                    </p>
                  </div>
              </div>

              <!-- User Input Area -->
              
              <div class="user-input-container">
                <div class="attached-files-container"></div>
                <div class="input-wrapper">
                  <textarea placeholder="Ask DKM assistant..."></textarea>
                  <div class="input-actions">
                    <div class="send-actions">
                      <input type="file" id="fileInput" style="display: none;"> 
                      <button class="action-button attach-button" id="attachButton" >
                        <i class="fas fa-paperclip"></i>
                      </button>
                      <button class="action-button send-button" disabled>
                        <i class="fas fa-paper-plane"></i>
                      </button>
                    </div>
                  </div>
                </div>

                <p>Content generated by AI model, please verify carefully</p>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Confirmation Popup -->
    <div id="confirmationPopup" class="popup-container">
      <div class="popup-content">
        <h3>Confirm Assistant Change</h3>
        <p>
          All your current chat messages will be lost. Are you sure you want to
          continue?
        </p>
        <div class="popup-buttons">
          <button id="confirmSwitch" class="button primary">Confirm</button>
          <button id="cancelSwitch" class="button secondary">Cancel</button>
        </div>
      </div>
    </div>

    <%- include('partials/footer') %>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="/js/chatbots.js"></script>
    <script src="/js/chatui.js"></script>
  </body>
</html>
